From ef75913b08e709329df1f325ac05033efbbe3d3c Mon Sep 17 00:00:00 2001
From: Remi Collet <remi@remirepo.net>
Date: Fri, 17 Jan 2020 09:49:38 +0100
Subject: [PATCH 1/2] fix installation layout, e.g. honors GNUInstallDirs

---
 CMakeLists.txt             |  4 ++--
 kms-message/CMakeLists.txt | 20 ++++++++++----------
 2 files changed, 12 insertions(+), 12 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 2bef1a7..010c292 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -351,7 +351,7 @@ configure_file (cmake/mongocrypt-config.cmake
 install (EXPORT mongocrypt_targets
    NAMESPACE mongo::
    FILE mongocrypt_targets.cmake
-   DESTINATION lib/cmake/mongocrypt
+   DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/mongocrypt
 )
 
 install (
@@ -359,7 +359,7 @@ install (
       cmake/mongocrypt-config.cmake
       "${CMAKE_CURRENT_BINARY_DIR}/mongocrypt/mongocrypt-config-version.cmake"
    DESTINATION
-      lib/cmake/mongocrypt
+      ${CMAKE_INSTALL_LIBDIR}/cmake/mongocrypt
    COMPONENT
       Devel
 )
diff --git a/kms-message/CMakeLists.txt b/kms-message/CMakeLists.txt
index fcfb07d..bfc1bd0 100644
--- a/kms-message/CMakeLists.txt
+++ b/kms-message/CMakeLists.txt
@@ -124,10 +124,10 @@ set_property (TARGET kms_message_static APPEND PROPERTY
 include (CMakePackageConfigHelpers)
 install (TARGETS kms_message kms_message_static
    EXPORT kms_message_targets
-   LIBRARY DESTINATION lib
-   ARCHIVE DESTINATION lib
-   RUNTIME DESTINATION bin
-   INCLUDES DESTINATION include
+   LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
+   ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
+   RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
+   INCLUDES DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}
 )
 
 install (
@@ -141,7 +141,7 @@ install (
    src/kms_message/kms_request_opt.h
    src/kms_message/kms_response.h
    src/kms_message/kms_response_parser.h
-   DESTINATION include/kms_message
+   DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/kms_message
    COMPONENT Devel
 )
 
@@ -162,7 +162,7 @@ configure_file (cmake/kms_message-config.cmake
    COPYONLY
 )
 
-set (ConfigPackageLocation lib/cmake/kms_message)
+set (ConfigPackageLocation ${CMAKE_INSTALL_LIBDIR}/cmake/kms_message)
 install (EXPORT kms_message_targets
    NAMESPACE mongo::
    FILE kms_message_targets.cmake
@@ -178,8 +178,8 @@ install (
 )
 
 # pkg-config.
-set (PKG_CONFIG_LIBDIR "\${prefix}/lib")
-set (PKG_CONFIG_INCLUDEDIR "\${prefix}/include")
+set (PKG_CONFIG_LIBDIR "\${prefix}/${CMAKE_INSTALL_LIBDIR}")
+set (PKG_CONFIG_INCLUDEDIR "\${prefix}/${CMAKE_INSTALL_INCLUDEDIR}")
 set (PKG_CONFIG_LIBS "-L\${libdir} -lkms_message")
 set (PKG_CONFIG_CFLAGS "-I\${includedir}")
 configure_file (
@@ -189,7 +189,7 @@ configure_file (
 
 install (
    FILES "${CMAKE_CURRENT_BINARY_DIR}/libkms_message.pc"
-   DESTINATION lib/pkgconfig
+   DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig
 )
 
 # cannot run tests without crypto
@@ -211,4 +211,4 @@ if (NOT DISABLE_NATIVE_CRYPTO)
       target_link_libraries(test_kms_request "${OPENSSL_LIBRARIES}")
       target_include_directories(test_kms_request PRIVATE "${OPENSSL_INCLUDE_DIR}")
    endif()
-endif ()
\ No newline at end of file
+endif ()
-- 
2.24.1

